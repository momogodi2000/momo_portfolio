#!/bin/bash

# ðŸš€ MOMO YVAN Portfolio - Quick Deployment Script
# Run this script to prepare and deploy your portfolio

echo "ðŸŽ¯ MOMO YVAN Portfolio Deployment Script"
echo "========================================"

# Check if we're in a git repository
if [ ! -d ".git" ]; then
    echo "âŒ Not a git repository. Please run 'git init' first."
    exit 1
fi

# 1. Install dependencies
echo "ðŸ“¦ Installing dependencies..."
npm install

# 2. Create necessary files
echo "ðŸ“„ Creating deployment files..."

# Create vercel.json
cat > vercel.json << 'EOF'
{
  "version": 2,
  "name": "momo-yvan-portfolio",
  "builds": [
    {
      "src": "package.json",
      "use": "@vercel/static-build",
      "config": {
        "distDir": "build"
      }
    }
  ],
  "routes": [
    {
      "src": "/static/(.*)",
      "headers": {
        "cache-control": "s-maxage=31536000,immutable"
      }
    },
    {
      "src": "/(.*)",
      "dest": "/index.html"
    }
  ]
}
EOF

# Create _redirects for SPA routing
mkdir -p public
cat > public/_redirects << 'EOF'
/*    /index.html   200
EOF

# Create robots.txt
cat > public/robots.txt << 'EOF'
User-agent: *
Allow: /

Sitemap: https://momoyvan-portfolio.vercel.app/sitemap.xml
EOF

# Create .env.production
cat > .env.production << 'EOF'
REACT_APP_ENVIRONMENT=production
REACT_APP_SITE_URL=https://momoyvan-portfolio.vercel.app
EOF

# 3. Update package.json with deployment scripts
echo "ðŸ”§ Adding deployment scripts to package.json..."
npm pkg set scripts.deploy:vercel="vercel --prod"
npm pkg set scripts.deploy:preview="vercel"
npm pkg set scripts.build:analyze="npm run build && npx serve -s build"

# 4. Test build
echo "ðŸ—ï¸ Testing build..."
npm run build

if [ $? -eq 0 ]; then
    echo "âœ… Build successful!"
else
    echo "âŒ Build failed! Please fix errors before deploying."
    exit 1
fi

# 5. Git commit (if changes exist)
echo "ðŸ“ Committing changes..."
git add .
git commit -m "ðŸš€ Prepare for deployment - Add deployment configs" || echo "No changes to commit"

echo ""
echo "ðŸŽ‰ Ready for deployment!"
echo ""
echo "ðŸ“‹ Next steps:"
echo "==============="
echo ""
echo "ðŸ”µ OPTION 1: Deploy to Vercel (Recommended)"
echo "   1. Install Vercel CLI: npm install -g vercel"
echo "   2. Login: vercel login"
echo "   3. Deploy: vercel"
echo "   4. For production: vercel --prod"
echo ""
echo "ðŸ”´ OPTION 2: Deploy to Render"
echo "   1. Push to GitHub: git push origin main"
echo "   2. Go to https://render.com"
echo "   3. Create New Static Site"
echo "   4. Connect your GitHub repo"
echo "   5. Build Command: npm run build"
echo "   6. Publish Directory: build"
echo ""
echo "ðŸŒ OPTION 3: Deploy to Netlify"
echo "   1. Go to https://netlify.com"
echo "   2. Drag and drop your 'build' folder"
echo "   3. Or connect GitHub repo"
echo ""
echo "ðŸ’¡ Tips:"
echo "   - Your site will be available at: https://your-app-name.vercel.app"
echo "   - You can add a custom domain later"
echo "   - Enable analytics by adding REACT_APP_GOOGLE_ANALYTICS_ID"
echo ""
echo "ðŸŽ¯ Your portfolio is ready to go live!"